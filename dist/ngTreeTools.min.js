"use strict";function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r)){for(var e=0,n=new Array(r.length);e<r.length;e++)n[e]=r[e];return n}}angular.module("ngTreeTools",[]).service("TreeTools",function(){return treeTools={find:function(r,e,n){var t=_.defaults(n,{limit:1}),i=this.parents(r,e,t);return _.isArray(i)?_.last(i):void 0},flatten:function(r,e){var t=_.defaults(e,{childNode:["children"]});t.childNode=_.castArray(t.childNode);var i=[];return function n(r){r.forEach(function(e){i.push(e),t.childNode.some(function(r){e[r]&&_.isArray(e[r])&&n(e[r])})})}(_.castArray(r)),i},parents:function(r,n,e){var i=_.isFunction(n)?_.noop:_.matches(n),o=[],c=_.defaults(e,{childNode:["children"]});c.childNode=_.castArray(c.childNode);return function t(r){var e=_.find(r,_.isFunction(n)?n:i);return e?(o.unshift(e),!0):r.some(function(e){var n=!1;return c.childNode.some(function(r){if(e[r]&&_.isArray(e[r])&&t(e[r]))return o.unshift(e),n=!0}),n})}(_.castArray(r)),o},children:function(r,e,n){e&&_.matches(e);var i=_.defaults(n,{childNode:["children"]});i.childNode=_.castArray(i.childNode);var t=e?treeTools.find(r,e):r,o=[];return function e(n,t){0<t&&o.push(n),i.childNode.some(function(r){if(n[r]&&_.isArray(n[r]))return n[r].forEach(function(r){e(r,t+1)}),!0})}(t,0),o},hasChildren:function(e,r){return _.defaults(r,{childNode:["children"]}).childNode.some(function(r){return e[r]&&_.isArray(e[r])&&e[r].length})},hasSome:function(r,e){return!!_.find(r,e)||(_.isObject(r)?_.some(r,function(r){return treeTools.hasSome(r,e)}):void 0)},resolve:function(r,e){var c=_.defaults(e,{childNode:"children",clone:!1,attempts:5,splice:!0,isPromise:_.isFunction,isSplice:function(r,e,n){var t=e.slice(0,-1),i=t.length?_.get(n,t):n;return _.isArray(r)&&_.isArray(i)},wrapper:function(r){return Promise.resolve(r())}}),s=c.clone?_.cloneDeep(r):r,a=!0,u=[];return Promise.resolve().then(function(){return new Promise(function(e,r){!function r(){0<--c.attempts&&a?(a=!1,function t(r,i){var o=[];return _.forEach(r,function(r,e){if(_.isArray(r))o.push(t(r,i.concat([e])));else if(_.isPlainObject(r))o.push(t(r,i.concat([e])));else if(_.isFunction(r)){var n=i.concat([e]);o.push(c.wrapper(r,n,s).then(function(r){!a&&_.isObject(r)&&treeTools.hasSome(r,function(r){return c.isPromise(r)})&&(a=!0),_.set(s,n,r),c.splice&&c.isSplice(r,n,s)&&u.push(n)}))}}),Promise.all(o)}(s,[]).then(r)):e()}()})}).then(function(){if(c.splice)return u.reverse().forEach(function(r){var e=r.slice(0,-1),n=e.length?_.get(s,e):s,t=r[r.length-1];n.splice.apply(n,[t,1].concat(_toConsumableArray(_.get(s,r))))}),null}).then(function(){return s})},sortBy:function(r,n){var t=this;return _.isArray(r)||(r=[r]),r.forEach(function(e){return _(e).keys().forEach(function(r){_.isArray(e[r])&&(e[r]=t.sortBy(e[r],n))})}),_.sortBy(r,n)}}});