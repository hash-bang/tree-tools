"use strict";function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r)){for(var n=0,e=new Array(r.length);n<r.length;n++)e[n]=r[n];return e}}angular.module("ngTreeTools",[]).service("TreeTools",function(){var l;return l={find:function(r,n,e){var t=_.defaults(e,{limit:1}),i=this.parents(r,n,t);return _.isArray(i)?_.last(i):void 0},filter:function(r,n,e){var t=_.isFunction(n)?n:_.matches(n),i=_.defaults(e,{childNode:["children"]});i.childNode=_.castArray(i.childNode);var o=function e(r){return r.filter(function(r,n){return t(r,n)}).map(function(n){return i.childNode.some(function(r){_.has(n,r)&&(_.isArray(n[r])?n[r]=e(n[r]):delete n[r])}),n})};return _.isArray(r)?o(r)||[]:o([r])[0]||{}},flatten:function(r,n){var t=_.defaults(n,{childNode:["children"]});t.childNode=_.castArray(t.childNode);var i=[];return function e(r){r.forEach(function(n){i.push(n),t.childNode.some(function(r){n[r]&&_.isArray(n[r])&&e(n[r])})})}(_.castArray(r)),i},parents:function(r,e,n){var i=_.isFunction(e)?_.noop:_.matches(e),o=[],c=_.defaults(n,{childNode:["children"]});c.childNode=_.castArray(c.childNode);return function t(r){var n=_.find(r,_.isFunction(e)?e:i);return n?(o.unshift(n),!0):r.some(function(n){var e=!1;return c.childNode.some(function(r){if(n[r]&&_.isArray(n[r])&&t(n[r]))return o.unshift(n),e=!0}),e})}(_.castArray(r)),o},children:function(r,n,e){n&&_.matches(n);var i=_.defaults(e,{childNode:["children"]});i.childNode=_.castArray(i.childNode);var t=n?l.find(r,n):r,o=[];return function n(e,t){0<t&&o.push(e),i.childNode.some(function(r){if(e[r]&&_.isArray(e[r]))return e[r].forEach(function(r){n(r,t+1)}),!0})}(t,0),o},hasChildren:function(n,r){return _.defaults(r,{childNode:["children"]}).childNode.some(function(r){return n[r]&&_.isArray(n[r])&&n[r].length})},hasSome:function(r,n){return!!_.find(r,n)||(_.isObject(r)?_.some(r,function(r){return l.hasSome(r,n)}):void 0)},resolve:function(r,n){var c=_.defaults(n,{childNode:"children",clone:!1,attempts:5,splice:!0,isPromise:_.isFunction,isSplice:function(r,n,e){var t=n.slice(0,-1),i=t.length?_.get(e,t):e;return _.isArray(r)&&_.isArray(i)},wrapper:function(r){return Promise.resolve(r())}}),a=c.clone?_.cloneDeep(r):r,s=!0,u=[];return Promise.resolve().then(function(){return new Promise(function(n,r){!function r(){0<--c.attempts&&s?(s=!1,function t(r,i){var o=[];return _.forEach(r,function(r,n){if(_.isArray(r))o.push(t(r,i.concat([n])));else if(_.isPlainObject(r))o.push(t(r,i.concat([n])));else if(_.isFunction(r)){var e=i.concat([n]);o.push(c.wrapper(r,e,a).then(function(r){!s&&_.isObject(r)&&l.hasSome(r,function(r){return c.isPromise(r)})&&(s=!0),_.set(a,e,r),c.splice&&c.isSplice(r,e,a)&&u.push(e)}))}}),Promise.all(o)}(a,[]).then(r)):n()}()})}).then(function(){if(c.splice)return u.reverse().forEach(function(r){var n=r.slice(0,-1),e=n.length?_.get(a,n):a,t=r[r.length-1];e.splice.apply(e,[t,1].concat(_toConsumableArray(_.get(a,r))))}),null}).then(function(){return a})},sortBy:function(r,e){var t=this;return _.isArray(r)||(r=[r]),r.forEach(function(n){return _(n).keys().forEach(function(r){_.isArray(n[r])&&(n[r]=t.sortBy(n[r],e))})}),_.sortBy(r,e)}}});